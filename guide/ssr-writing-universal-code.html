<!DOCTYPE html><html lang="en"><title>Writing Universal Code - Quasar Framework</title><meta charset="utf-8"><meta name="description" content="Quasar Framework - High Performance Full Frontend Stack - Single Page Apps, Server-side Render Apps, Progressive Web Apps, Hybrid Mobile Apps and Electron Apps, all using the same codebase"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Mono|Source+Sans+Pro"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"><link rel="icon" href="/images/quasar-logo.png" type="image/x-icon"><link rel="stylesheet" href="/css/page-combined-f514a22a47.css"><body class=""><div id="header"><a class="menu-button"><i class="fa fa-bars"></i></a> <a id="logo" href="/" title="v0.17.7"><img src="/images/quasar-logo.png"> Quasar </a><a href="/guide/" class="menu-link current">Guide </a><a href="/components/" class="menu-link">Components </a><a href="/search/" class="menu-link" title="Search"><i class="fa fa-search" style="vertical-align:middle"></i> <span>Search</span> </a><a href="https://github.com/quasarframework/quasar" class="menu-link" target="_blank" title="Github"><i class="fa fa-github" style="vertical-align:middle"></i> <span>Github</span> </a><a href="https://twitter.com/quasarframework" class="menu-link" target="_blank" title="Twitter"><i class="fa fa-twitter" style="vertical-align:middle"></i> <span>Twitter</span> </a><a href="https://discord.gg/5TDhbDg" class="menu-link" target="_blank" title="Discord Chat"><i class="fa fa-comments" style="vertical-align:middle"></i> <span>Discord Chat</span> </a><a href="http://forum.quasar-framework.org" class="menu-link" target="_blank" title="Forum"><i class="fa fa-group" style="vertical-align:middle"></i> <span>Forum</span></a></div><div class="sidebar-backdrop"></div><div id="sidebar" class="sidebar"><div class="list"><div class="sidebar-menu"><a href="/guide/" class="menu-link current">Guide </a><a href="/components/" class="menu-link">Components </a><a href="/search/" class="menu-link" title="Search"><i class="fa fa-search" style="vertical-align:middle"></i> <span>Search</span> </a><a href="https://github.com/quasarframework/quasar" class="menu-link" target="_blank" title="Github"><i class="fa fa-github" style="vertical-align:middle"></i> <span>Github</span> </a><a href="https://twitter.com/quasarframework" class="menu-link" target="_blank" title="Twitter"><i class="fa fa-twitter" style="vertical-align:middle"></i> <span>Twitter</span> </a><a href="https://discord.gg/5TDhbDg" class="menu-link" target="_blank" title="Discord Chat"><i class="fa fa-comments" style="vertical-align:middle"></i> <span>Discord Chat</span> </a><a href="http://forum.quasar-framework.org" class="menu-link" target="_blank" title="Forum"><i class="fa fa-group" style="vertical-align:middle"></i> <span>Forum</span></a></div><div class="support-link"><a href="/support-quasar-framework.html"><i class="fa fa-ambulance"></i> Support Quasar</a></div><h3 class="q-version-select"><i class="fa fa-book"></i> Docs for<select id="version-select"><option value="">v0.17.7<option value="v0-15">v0.16<option value="v0-15">v0.15<option value="v0-14">v0.14<option value="v0-13">v0.13</select></h3><div style="margin-bottom:7px">Proudly sponsored by:</div><div style="margin-bottom:7px"><a href="http://truelogic.com/" target="_blank"><img src="/images/logo_truelogic.png" height="110px" width="110px"> </a><a href="https://www.tayloredtechnology.net" target="_blank"><img src="/images/logo_tayloredtechnology_small.jpeg" height="110px" width="110px"></a></div><div style="margin-bottom:25px"><a href="http://campuscloudservices.com/" target="_blank"><img src="/images/logo_campuscloud.png" width="200px"></a></div><h2>Guide</h2><ul class="menu-root"><li><a href="/guide/introduction-to-quasar.html" class="sidebar-link">Introduction to Quasar</a><li><a href="/guide/quasar-playground.html" class="sidebar-link">Playground</a><li><a href="/guide/quasar-contribution-guide.html" class="sidebar-link">Contribution Guide</a><li><a href="/guide/quasar-release-notes.html" class="sidebar-link">Release Notes</a><li><a href="/guide/quasar-roadmap.html" class="sidebar-link">Roadmap</a><li><a href="/guide/quasar-upgrade-guide.html" class="sidebar-link">Upgrade Guide</a></ul><h3>Getting Started</h3><ul class="menu-root"><li><a href="/guide/index.html" class="sidebar-link">Installation</a><li><a href="/guide/quasar-cli.html" class="sidebar-link">Quasar CLI</a></ul><h3>UMD / Standalone</h3><ul class="menu-root"><li><a href="/guide/embedding-quasar.html" class="sidebar-link">Embedding Quasar</a></ul><h3>Starter Kit</h3><ul class="menu-root"><li><a href="/guide/app-installation.html" class="sidebar-link">Installation</a><li><a href="/guide/app-directory-structure.html" class="sidebar-link">Directory Structure</a><li><a href="/guide/app-quasar.conf.js.html" class="sidebar-link">quasar.conf.js</a><li><a href="/guide/app-build-commands.html" class="sidebar-link">Build Commands</a><li><a href="/guide/app-routing.html" class="sidebar-link">Routing</a><li><a href="/guide/app-adding-pages-and-layouts.html" class="sidebar-link">Adding Pages and Layouts</a><li><a href="/guide/app-lazy-loading---code-splitting.html" class="sidebar-link">Lazy Loading - Code Splitting</a><li><a href="/guide/app-handling-assets.html" class="sidebar-link">Handling Assets</a><li><a href="/guide/app-plugins.html" class="sidebar-link">App Plugins</a><li><a href="/guide/app-prefetch-feature.html" class="sidebar-link">Prefetch Feature</a><li><a href="/guide/app-api-proxying.html" class="sidebar-link">API Proxying</a><li><a href="/guide/app-pre-processors-and-webpack.html" class="sidebar-link">Pre-Processors and Webpack</a><li><a href="/guide/app-vuex-store.html" class="sidebar-link">Vuex Store</a><li><a href="/guide/quasar-theming.html" class="sidebar-link">Theming</a><li><a href="/guide/app-linter.html" class="sidebar-link">App Linter</a><li><a href="/guide/app-supporting-ie.html" class="sidebar-link">Supporting IE</a><li><a href="/guide/app-deploying-spa.html" class="sidebar-link">Deploying SPA</a></ul><h3>Developing SSR</h3><ul class="menu-root"><li><a href="/guide/ssr-introduction.html" class="sidebar-link">Introduction</a><li><a href="/guide/ssr-writing-universal-code.html" class="sidebar-link current">Writing Universal Code</a><li><a href="/guide/ssr-configuring-ssr.html" class="sidebar-link">Configuring SSR</a><li><a href="/guide/ssr-client-side-hydration.html" class="sidebar-link">Client Side Hydration</a><li><a href="/guide/ssr-handling-404-and-500-errors.html" class="sidebar-link">Handling 404 and 500 Errors</a><li><a href="/guide/ssr-with-pwa.html" class="sidebar-link">SSR with PWA</a><li><a href="/guide/ssr-frequently-asked-questions.html" class="sidebar-link">SSR Frequently Asked Questions</a><li><a href="/guide/ssr-build-commands.html" class="sidebar-link">Build Commands</a><li><a href="/guide/ssr-deploying.html" class="sidebar-link">Deploying</a></ul><h3>Developing PWA</h3><ul class="menu-root"><li><a href="/guide/pwa-introduction.html" class="sidebar-link">Introduction</a><li><a href="/guide/pwa-configuring-pwa.html" class="sidebar-link">Configuring PWA</a><li><a href="/guide/pwa-build-commands.html" class="sidebar-link">Build Commands</a></ul><h3>Developing Mobile Apps</h3><ul class="menu-root"><li><a href="/guide/cordova-introduction.html" class="sidebar-link">Introduction</a><li><a href="/guide/cordova-preparation.html" class="sidebar-link">Preparation</a><li><a href="/guide/cordova-configuring-cordova.html" class="sidebar-link">Configuring Cordova</a><li><a href="/guide/cordova-plugins.html" class="sidebar-link">Cordova Plugins</a><li><a href="/guide/cordova-build-commands.html" class="sidebar-link">Build Commands</a><li><a href="/guide/cordova-troubleshooting-and-tips.html" class="sidebar-link">Troubleshooting and Tips</a><li><a href="/guide/cordova-managing-google-analytics.html" class="sidebar-link">Managing Google Analytics</a><li><a href="/guide/cordova-publishing-to-store.html" class="sidebar-link">Publishing to Store</a></ul><h3>Developing Electron Apps</h3><ul class="menu-root"><li><a href="/guide/electron-introduction.html" class="sidebar-link">Introduction</a><li><a href="/guide/electron-preparation.html" class="sidebar-link">Preparation</a><li><a href="/guide/electron-configuring-electron.html" class="sidebar-link">Configuring Electron</a><li><a href="/guide/electron-packages.html" class="sidebar-link">Electron Packages</a><li><a href="/guide/electron-build-commands.html" class="sidebar-link">Build Commands</a><li><a href="/guide/electron-static-assets.html" class="sidebar-link">Electron Static Assets</a><li><a href="/guide/electron-troubleshooting-and-tips.html" class="sidebar-link">Troubleshooting and Tips</a></ul><h3>Misc</h3><ul class="menu-root"><li><a href="/guide/ajax-requests.html" class="sidebar-link">Ajax Requests</a><li><a href="/guide/opening-dev-server-to-public.html" class="sidebar-link">Opening Dev Server To Public</a></ul></div></div><div id="main"><div class="content"><h1>Writing Universal Code <a href="https://github.com/quasarframework/quasar-site/edit/dev/source/guide/ssr-writing-universal-code.md" target="_blank">&nbsp;&nbsp;<i class="fa fa-pencil"></i>&nbsp;&nbsp;</a></h1><p>Writing “universal” code means writing code that runs on both the server and the client. Due to use-case and platform API differences, the behavior of our code will not be exactly the same when running in different environments. Here we will go over the key things you need to be aware of.<p><img src="/images/ssr-build.png" alt="Quasar SSR Build System" title="Quasar SSR Build System"><h2 id="Data-Reactivity-on-the-Server"><a href="#Data-Reactivity-on-the-Server" class="headerlink" title="Data Reactivity on the Server"></a>Data Reactivity on the Server</h2><p>In a client-only app, every user will be using a fresh instance of the app in their browser. For server-side rendering we want the same: each request should have a fresh, isolated app instance so that there is no cross-request state pollution.<p>Because the actual rendering process needs to be deterministic, we will also be “pre-fetching” data on the server - this means our application state will be already resolved when we start rendering. This means data reactivity is unnecessary on the server, so it is disabled by default. Disabling data reactivity also avoids the performance cost of converting data into reactive objects.<h2 id="Component-Lifecycle-Hooks"><a href="#Component-Lifecycle-Hooks" class="headerlink" title="Component Lifecycle Hooks"></a>Component Lifecycle Hooks</h2><p>Since there are no dynamic updates, of all the Vue lifecycle hooks, only <code>beforeCreate</code> and <code>created</code> will be called during SSR. This means any code inside other lifecycle hooks such as <code>beforeMount</code> or <code>mounted</code> will only be executed on the client.<p>Another thing to note is that you should avoid code that produces global side effects in <code>beforeCreate</code> and <code>created</code>, for example setting up timers with <code>setInterval</code>. In client-side only code we may setup a timer and then tear it down in <code>beforeDestroy</code> or <code>destroyed</code>. However, because the destroy hooks will not be called during SSR, the timers will stay around forever. To avoid this, move your side-effect code into <code>beforeMount</code> or <code>mounted</code> instead.<h2 id="Avoid-Stateful-Singletons"><a href="#Avoid-Stateful-Singletons" class="headerlink" title="Avoid Stateful Singletons"></a>Avoid Stateful Singletons</h2><p>When writing client-only code, we are used to the fact that our code will be evaluated in a fresh context every time. However, a Node.js server is a long-running process. When our code is required into the process, it will be evaluated once and then it stays in memory. This means if you create a singleton object, it will be shared between every incoming request.<p>So, Quasar CLI creates a new root Vue instance with a new Router and Vuex Store instances for each request. This is similar to how each user will be using a fresh instance of the app in their own browser. If we would have used a shared instance across multiple requests, it will easily lead to cross-request state pollution.<p>Instead of directly creating a Router and Vuex Store instances, you’ll be exposing a factory function that can be repeatedly executed to create fresh app instances for each request:<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// src/router/index.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> (<span class="params"><span class="regexp">/* &#123; store, ssrContext &#125; */</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> Router = <span class="keyword">new</span> VueRouter(&#123;...&#125;)</span><br><span class="line">  <span class="keyword">return</span> Router</span><br><span class="line">&#125;</span><br></pre></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// src/store/index.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> (<span class="params"><span class="regexp">/* &#123; ssrContext &#125; */</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> Store = <span class="keyword">new</span> Vuex.Store(&#123;...&#125;)</span><br><span class="line">  <span class="keyword">return</span> Store</span><br><span class="line">&#125;</span><br></pre></table></figure><h2 id="Access-to-Platform-Specific-APIs"><a href="#Access-to-Platform-Specific-APIs" class="headerlink" title="Access to Platform-Specific APIs"></a>Access to Platform-Specific APIs</h2><p>Universal code cannot assume access to platform-specific APIs, so if your code directly uses browser-only globals like <code>window</code> or <code>document</code>, they will throw errors when executed in Node.js, and vice-versa.<p>For tasks shared between server and client but use different platform APIs, it’s recommended to wrap the platform-specific implementations inside a universal API, or use libraries that do this for you. For example, <a href="https://github.com/axios/axios" target="_blank" rel="noopener">Axios</a> is an HTTP client that exposes the same API for both server and client.<p>For browser-only APIs, the common approach is to lazily access them inside client-only lifecycle hooks.<h2 id="App-Plugins"><a href="#App-Plugins" class="headerlink" title="App Plugins"></a>App Plugins</h2><p>Note that if a 3rd party library is not written with universal usage in mind, it could be tricky to integrate it into an server-rendered app. You <em>might</em> be able to get it working by mocking some of the globals, but it would be hacky and may interfere with the environment detection code of other libraries.<p>When you add a 3rd party library to your project (through an <a href="/guide/app-plugins.html">App Plugin</a>), take into consideration whether it can run on server and on client. If it needs to run only on server or only on client, then specify this in quasar.conf.js:<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// quasar.conf.js</span></span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="string">'some-plugin'</span>, <span class="comment">// runs on both server &amp; client</span></span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">'some-other'</span>, <span class="attr">server</span>: <span class="literal">false</span> &#125; <span class="comment">// this plugin gets embedded only on client-side</span></span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">'third'</span>, <span class="attr">client</span>: <span class="literal">false</span> &#125; <span class="comment">// this plugin gets embedded only on server-side</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></table></figure><h2 id="Data-Pre-Fetching-and-State"><a href="#Data-Pre-Fetching-and-State" class="headerlink" title="Data Pre-Fetching and State"></a>Data Pre-Fetching and State</h2><p>During SSR, we are essentially rendering a “snapshot” of our app, so if the app relies on some asynchronous data, this data need to be pre-fetched and resolved before we start the rendering process.<p>The Quasar CLI <a href="/guide/app-prefetch-feature.html">preFetch</a> feature has been created to solve this problem. Take a few moments to read about it.<hr><p>Parts of this page are taken from the official <a href="https://ssr.vuejs.org/guide/universal.html#data-reactivity-on-the-server" target="_blank" rel="noopener">Vue.js SSR guide</a>.<div class="guide-links"><span><a href="/guide/ssr-introduction.html"><i class="fa fa-chevron-left"></i> Introduction</a></span> <span style="float:right"><a href="/guide/ssr-configuring-ssr.html">Configuring SSR <i class="fa fa-chevron-right"></i></a></span></div><div class="footer"><hr><div>Last updated: Wed Jul 25 2018</div>Caught a mistake or want to contribute to the documentation? <a href="https://github.com/quasarframework/quasar-site/edit/dev/source/guide/ssr-writing-universal-code.md" target="_blank">Suggest an edit on GitHub <i class="fa fa-pencil"></i></a></div></div><aside id="preview" style="display:none"><div id="preview-chooser"><a data-theme="android" class="active"><i class="fa fa-android"></i></a> <a data-theme="apple"><i class="fa fa-apple"></i></a></div><div id="android-preview" class="theme active"><iframe id="android-iframe" frameborder="0"></iframe><a class="desktop-launcher" target="_blank"><i class="fa fa-desktop"></i><br>Desktop View</a> <a class="view-source" target="_blank"><i class="fa fa-file-code-o"></i><br>View Source</a></div><div id="apple-preview" class="theme"><iframe id="apple-iframe" frameborder="0"></iframe><a class="desktop-launcher" target="_blank"><i class="fa fa-desktop"></i><br>Desktop View</a> <a class="view-source" target="_blank"><i class="fa fa-file-code-o"></i><br>View Source</a></div></aside></div><script src="https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script><script>document.addEventListener("DOMContentLoaded",function(){FastClick.attach(document.body)},!1)</script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/smooth-scroll/7.1.1/js/smooth-scroll.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script><script src="/js/page-combined-1aa467504d.js"></script><script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-6317975-4","auto"),ga("send","pageview")</script>